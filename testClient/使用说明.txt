IM聊天客户端使用说明
===================

## 快速开始

### 启动聊天客户端
运行: start-chat.bat

按提示选择认证方式：
1. 注册新用户 - 创建新账号并开始聊天
2. 登录现有用户 - 使用已有账号登录
3. 调试模式 - 跳过认证，指定用户ID快速测试

### 多窗口聊天
多次运行 start-chat.bat 可以启动多个聊天窗口，模拟多用户聊天场景。

## 使用示例

### 双用户聊天测试
1. 窗口1: 调试模式，用户1001，聊天对象1002
2. 窗口2: 调试模式，用户1002，聊天对象1001
3. 在任一窗口发送消息，另一窗口会实时收到

### 历史消息测试
- 用户登录时会自动收到历史消息
- 如果没有历史消息，可以自行发送消息进行测试

## 功能特点

- 实时消息收发
- 用户上线自动拉取历史消息
- 支持用户注册和登录
- 调试模式快速测试
- 多窗口同时聊天

## 用户ID说明

### 调试模式 (-skip)
- 当前用户: 固定1001
- 用户名: debug_user
- Token: auth-debug
- 优点: 快速测试，无需认证
- 缺点: 只能模拟单一用户

### 正常模式
- 当前用户: 通过注册/登录获取
- 用户名: 用户输入
- Token: 服务器生成的JWT
- 优点: 真实的多用户测试
- 缺点: 需要完整的认证流程

## 双用户对话测试方案

### 方案1: 两个正常模式
窗口1: go run main.go -target=用户B的ID
窗口2: go run main.go -target=用户A的ID
说明: 需要先注册两个不同的用户

### 方案2: 混合模式（推荐）
窗口1: go run main.go -target=1002 -skip  (调试模式，用户1001)
窗口2: go run main.go -target=1001        (正常模式，注册真实用户)

## 客户端内命令

help 或 h        - 显示帮助信息
exit 或 quit 或 q - 退出程序
target           - 更改目标用户ID
/to <用户ID>     - 快速切换目标用户
其他输入         - 发送消息

## 注意事项

1. 确保以下服务已启动:
   - User Service (端口21001)
   - Connect Service (端口21005)
   - MongoDB、Redis等基础设施

2. 调试模式固定使用用户ID 1001
3. 正常模式需要注册/登录获取真实用户ID
4. 确保两个客户端的目标用户ID互相对应

## 故障排除

Q: 连接失败
A: 检查Connect Service是否启动，端口21005是否可用

Q: 认证失败
A: 检查用户名密码是否正确，或使用调试模式跳过认证

Q: 消息发送失败
A: WebSocket连接已断开，请重启客户端
